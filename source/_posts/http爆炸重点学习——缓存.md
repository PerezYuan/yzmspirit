---
title: http爆炸重点学习——缓存
date: 2017-03-28 18:11:15
tags:
- http
categories: 前端技术
---

忙碌的三月，迟来的总结，今天写写http协议一个非常重要的点——缓存的处理。

<!-- more -->

> 缓存的作用是不言而喻的，它是web中各个方面性能优化的利器，关于http中的缓存，权威指南中的介绍非常直观：

> - 缓存减少了冗余的数据传输，节省了你的网络费用。

> - 缓存缓解了网络瓶颈的问题。不需要更多的带宽就能够更快地加载页面。

> - 缓存降低了对原始服务器的要求。服务器可以更快地响应，避免过载的出现。

> - 缓存降低了距离时延，因为从较远的地方加载页面会更慢一些。

其中也有一个最基本的概念：

> 可以用已有的副本为某些到达缓存的请求提供服务。这被称为缓存命中（cache hit），其他一些到达缓存的请求可能会由于没有副本可用，而被转发给原始服务器。这被称为缓存未命中（cache miss）。

# 1.一图流
{% img /img/20170328.png 926 604 一图流 %}

上图中涉及到一些http首部字段，后面会慢慢讲到，首先我们可以把上图拆分成3种最简单的逻辑来分析。

## 1) 缓存未命中

分两种情况：
- 缓存必须要在浏览器访问过一次资源后才会产生，所以最简单的情况是第一次请求资源，直接从服务器上成功获取到资源，并设置一系列缓存相关的http头信息，如下图。

{% img /img/20170328_1.png 662 274 缓存未命中 %}

- 再次访问通过http首部字段验证不满足使用缓存的条件，如下图。

{% img /img/20170328_4.png 662 274 缓存未命中 %}

## 2) 缓存命中
- 缓存直接命中，这种情况也叫浏览器缓存命中（强缓存命中），这种直接返回状态码200（from cache）

{% img /img/20170328_2.png 662 274 缓存命中 %}


## 3) 缓存再验证命中
- 缓存再验证命中，这种也叫做协商缓存命中，在强缓存验证不通过的情况下，会像服务器端发送一个协商缓存验证的信息，如果此时服务器发现请求资源未修改，则返回状态码304（Not Modified）告知服务器从缓存中获取资源并更新协商缓存信息。这种情况通缓存未命中的第二种情况相对应。

{% img /img/20170328_3.png 662 274 缓存再验证命中 %}



# 2.浏览器缓存（强缓存）
